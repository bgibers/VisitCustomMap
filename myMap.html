<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <script src="amcharts4/core.js"></script>
  <script src="amcharts4/maps.js"></script>
  <script src="amcharts4/geodata/lows/worldLow.js"></script>
  <script src="amcharts4/geodata/lows/usaLow.js"></script>
  <script src="amcharts4/geodata/lows/russiaLow.js"></script>
  <script src="amcharts4/geodata/lows/canadaLow.js"></script>
  <script src="amcharts4/themes/animated.js"></script>
</head>
<script> 

var polygonTemplate;
var worldSeries;
var usaSeries;
var canadaSeries;
var russiaSeries;

am4core.ready(function() {

// Themes begin
am4core.useTheme(am4themes_animated);
// Themes end

// Create map instance
var chart = am4core.create("chartdiv", am4maps.MapChart);
//chart.background.fill = am4core.color("#aadaff");
//chart.background.fillOpacity = 1;  
chart.geodata = am4geodata_worldLow;
chart.projection = new am4maps.projections.Miller(); 
chart.zoomControl = new am4maps.ZoomControl();
chart.tapToActivate = true;

// Series for World map
worldSeries = chart.series.push(new am4maps.MapPolygonSeries());
worldSeries.exclude = ["AQ"];
worldSeries.useGeodata = true;

polygonTemplate = worldSeries.mapPolygons.template;
polygonTemplate.tooltipText = "{name}";
// polygonTemplate.fill = chart.colors.getIndex(0);
polygonTemplate.nonScalingStroke = true;
polygonTemplate.applyOnClones = true;
// polygonTemplate.togglable = true;
polygonTemplate.tooltipText = "{name}";
polygonTemplate.strokeOpacity = 0.5;


// Create states for world map
var lastSelected;
var activeState = polygonTemplate.states.create("active");
// activeState.properties.fill = chart.colors.getIndex(4);

// var hs = polygonTemplate.states.create("hover");
// hs.properties.fill = chart.colors.getIndex(4);

var visited = polygonTemplate.states.create("visited");
visited.properties.fill = am4core.color("#0000FF");

var toVisit = polygonTemplate.states.create("toVisit");
toVisit.properties.fill = am4core.color("#E94F37");

// Series for United States map
usaSeries = chart.series.push(new am4maps.MapPolygonSeries());
usaSeries.geodata = am4geodata_usaLow;

var usPolygonTemplate = usaSeries.mapPolygons.template;
usPolygonTemplate.tooltipText = "{name}";
// usPolygonTemplate.fill = chart.colors.getIndex(1);
usPolygonTemplate.nonScalingStroke = true;

var usVisited = usPolygonTemplate.states.create("visited");
usVisited.properties.fill = am4core.color("#0000FF");

var usToVisit = usPolygonTemplate.states.create("toVisit");
usToVisit.properties.fill = am4core.color("#E94F37");


// Series for Canada map
canadaSeries = chart.series.push(new am4maps.MapPolygonSeries());
canadaSeries.geodata = am4geodata_canadaLow;

var canadaPolygonTemplate = canadaSeries.mapPolygons.template;
canadaPolygonTemplate.tooltipText = "{name}";
canadaPolygonTemplate.nonScalingStroke = true;

var canadaVisited = canadaPolygonTemplate.states.create("visited");
canadaVisited.properties.fill = am4core.color("#0000FF");

var canadaToVisit = canadaPolygonTemplate.states.create("toVisit");
canadaToVisit.properties.fill = am4core.color("#E94F37");

// Series for Russia map
russiaSeries = chart.series.push(new am4maps.MapPolygonSeries());
russiaSeries.geodata = am4geodata_russiaLow;

var russiaPolygonTemplate = russiaSeries.mapPolygons.template;
russiaPolygonTemplate.tooltipText = "{name}";
russiaPolygonTemplate.nonScalingStroke = true;

var russiaVisited = russiaPolygonTemplate.states.create("visited");
russiaVisited.properties.fill = am4core.color("#0000FF");

var russiaToVisit = russiaPolygonTemplate.states.create("toVisit");
russiaToVisit.properties.fill = am4core.color("#E94F37");


// Hover state
// var usahs = usPolygonTemplate .states.create("hover");
// usahs.properties.fill = chart.colors.getIndex(4);

console.log(polygonTemplate)
console.log(worldSeries)

polygonTemplate.events.on("hit", function(ev) {
    var data = ev.target.dataItem.dataContext;
    console.log(data.id)
    console.log(data.name)
    console.log(data.visited)
    //chttps://codepen.io/team/amcharts/pen/qgLprb
    //create seperate json file to read id's from 

  ev.target.series.chart.zoomToMapObject(ev.target);
  if (lastSelected !== ev.target) {
    lastSelected = ev.target;
  }
});
polygonTemplate.events.off("doubleHit");


usPolygonTemplate.events.on("hit", function(ev) {
    var data = ev.target.dataItem.dataContext;
    console.log(data.id)
    console.log(data.name)
    console.log(data.visited)

  ev.target.series.chart.zoomToMapObject(ev.target);
  if (lastSelected !== ev.target) {
    lastSelected = ev.target;
  }
});

canadaPolygonTemplate.events.on("hit", function(ev) {
    var data = ev.target.dataItem.dataContext;
    console.log(data.id)
    console.log(data.name)
    console.log(data.visited)

  ev.target.series.chart.zoomToMapObject(ev.target);
  if (lastSelected !== ev.target) {
    lastSelected = ev.target;
  }
});

russiaPolygonTemplate.events.on("hit", function(ev) {
    var data = ev.target.dataItem.dataContext;
    console.log(data.id)
    console.log(data.name)
    console.log(data.visited)

  ev.target.series.chart.zoomToMapObject(ev.target);
  if (lastSelected !== ev.target) {
    lastSelected = ev.target;
  }
});

//Home button
var homeButton = new am4core.Button();
homeButton.events.on("hit", function(){
  chart.goHome();
});

var addButton = new am4core.Button();
addButton.events.on("hit", function(){
  changeVisitStatus(lastSelected.dataItem.dataContext.id,"toVisit");
});

homeButton.icon = new am4core.Sprite();
homeButton.padding(7, 5, 7, 5);
homeButton.width = 30;
homeButton.icon.path = "M16,8 L14,8 L14,16 L10,16 L10,10 L6,10 L6,16 L2,16 L2,8 L0,8 L8,0 L16,8 Z M16,8";
homeButton.marginBottom = 10;
homeButton.parent = chart.zoomControl;
homeButton.insertBefore(chart.zoomControl.plusButton);

// new location button

addButton.padding(7, 5, 7, 5);
addButton.width = 30;
addButton.marginBottom = 10;
addButton.parent = chart.zoomControl;

var editImage = addButton.createChild(am4core.Image);
editImage.href = "heart.png";
editImage.width = 15;
editImage.height = 15;
addButton.insertBefore(chart.zoomControl.homeButton);

var legend = new am4maps.Legend();
legend.parent = chart.chartContainer;
legend.background.fill = am4core.color("#000");
legend.background.fillOpacity = 0.05;
legend.width = 130;
legend.align = "left";
legend.valign = "bottom"
legend.contentAlign = "left";
legend.padding(10, 15, 10, 15);
legend.data = [{
  "name": "Plans to visit",
  "fill":"#E94F37"
}, {
  "name": "Visited",
  "fill": "#0000FF"
}];
legend.itemContainers.template.clickable = false;
legend.itemContainers.template.focusable = false;


//manually trigger event
//chart.zoomOutButton.dispatchImmediately("hit");
//https://www.amcharts.com/docs/v4/concepts/event-listeners/
}); // end am4core.ready()

//get longs and lat of clicked spot
//custom loader
//create onload function to read in all visited locations
//read in from json file
//https://www.amcharts.com/docs/v4/reference/spritestate/

function changeVisitStatus(locationId, status) { 
  $('#myModal').modal('show');
  console.log(location);

  if (locationId.toString().includes("US-")) {
    var data = usaSeries.getPolygonById(locationId)
  } else if (locationId.toString().includes("CA-")) {
    var data = canadaSeries.getPolygonById(locationId);
  } else if (locationId.toString().includes("RU-")) {
    var data = russiaSeries.getPolygonById(locationId);
  } else {
    var data = worldSeries.getPolygonById(locationId);
  }

  $('#myModalTitle').text(data.dataItem.dataContext.name); 

  if (status === "visited") {
      data.setState("visited");
  } 

  else if (status === "toVisit") {
    data.setState("toVisit");
  }
};

function onLoad() {
  var jsonObj = [
    {
        "location" : "US-SC",
        "status" : "visited"
    }
  ];
  for (var i = 0; i < jsonObj.length; i++) {
    changeVisitStatus(jsonObj[i].location,jsonObj[i].status);
  }
};

</script>

<!-- HTML -->
<!-- Create div that shows selected and status -->
<body>
<div id="chartdiv" onload="onLoad()"></div>
    <!-- Modal -->
    <div class="modal fade" id="myModal" role="dialog">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title" id="myModalTitle">Modal Header</h4>
          </div>
          <div class="modal-body">
            <p>Populate this with a description</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>